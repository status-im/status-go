package onramp

import (
	"context"
	"crypto/sha512"
	"errors"
	"fmt"
	"strings"
	"sync"
	"time"

	"github.com/ethereum/go-ethereum/common"

	walletCommon "github.com/status-im/status-go/services/wallet/common"
	"github.com/status-im/status-go/services/wallet/thirdparty/mercuryo"
	"github.com/status-im/status-go/services/wallet/token"
)

const mercuryoID = "mercuryo"
const mercuryioNoFeesBaseURL = "https://exchange.mercuryo.io/?type=buy&networks=ETHEREUM,ARBITRUM,OPTIMISM&currency=ETH"
const supportedAssetsUpdateInterval = 24 * time.Hour

type MercuryoProvider struct {
	supportedTokens          []*token.Token
	supportedTokensTimestamp time.Time
	supportedTokensLock      sync.RWMutex
	httpClient               *mercuryo.Client
	tokenManager             token.ManagerInterface
}

func NewMercuryoProvider(tokenManager token.ManagerInterface) *MercuryoProvider {
	return &MercuryoProvider{
		httpClient:   mercuryo.NewClient(),
		tokenManager: tokenManager,
	}
}

func (p *MercuryoProvider) ID() string {
	return mercuryoID
}

func (p *MercuryoProvider) GetCryptoOnRamp(ctx context.Context) (CryptoOnRamp, error) {
	const (
		logoMercuryo = "data:image/jpeg;base64,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"
	)

	provider := CryptoOnRamp{
		ID:                        mercuryoID,
		Name:                      "Mercuryo",
		Description:               "Buy crypto within 15 seconds",
		Fees:                      "4.5%",
		LogoURL:                   logoMercuryo,
		Hostname:                  "mercuryo.io",
		SupportsSinglePurchase:    true,
		SupportsRecurrentPurchase: true,
		SupportedChainIDs:         []uint64{walletCommon.EthereumMainnet, walletCommon.ArbitrumMainnet, walletCommon.OptimismMainnet},
		URLsNeedParameters:        true,
		SiteURL:                   mercuryioNoFeesBaseURL,
		RecurrentSiteURL:          mercuryioNoFeesBaseURL + "&widget_flow=recurrent",
	}

	var err error
	provider.SupportedTokens, err = p.getSupportedCurrencies(ctx)
	return provider, err
}

func (p *MercuryoProvider) getSupportedCurrencies(ctx context.Context) ([]*token.Token, error) {
	p.supportedTokensLock.Lock()
	defer p.supportedTokensLock.Unlock()

	if time.Since(p.supportedTokensTimestamp) < supportedAssetsUpdateInterval {
		return p.supportedTokens, nil
	}

	newSupportedCurrencies, err := p.httpClient.FetchCurrencies(ctx)
	if err != nil {
		return p.supportedTokens, err
	}

	newSupportedTokens := make([]*token.Token, 0, len(newSupportedCurrencies))
	for _, currency := range newSupportedCurrencies {
		chainID := mercuryo.NetworkToCommonChainID(currency.Network)
		if chainID == walletCommon.UnknownChainID {
			continue
		}
		token, isNative := p.tokenManager.LookupToken(&chainID, currency.Symbol)
		if token == nil {
			continue
		}
		if !isNative {
			contractAddress := common.HexToAddress(currency.Contract)
			if contractAddress != token.Address {
				continue
			}
		}
		newSupportedTokens = append(newSupportedTokens, token)
	}

	p.supportedTokens = newSupportedTokens
	p.supportedTokensTimestamp = time.Now()

	return p.supportedTokens, nil
}

// Should generate the SHA512 hash of the string "AddressKey"
func getMercuryoSignature(address common.Address, key string) string {
	addressString := address.Hex()

	hash := sha512.New()
	hash.Write([]byte(addressString[:] + key))
	return fmt.Sprintf("%x", hash.Sum(nil))
}

func getMercuryoCurrency(symbol string) string {
	return strings.ToUpper(symbol)
}

func (p *MercuryoProvider) GetURL(ctx context.Context, parameters Parameters) (string, error) {
	const (
		baseURL      = "https://exchange.mercuryo.io/?type=buy"
		widgetID     = "6a7eb330-2b09-49b7-8fd3-1c77cfb6cd47"
		widgetSecret = "AZ5fmxmrgyrXH3zre6yHU2Vw9fPqEw82" // #nosec G101
	)

	if parameters.DestAddress == nil || *parameters.DestAddress == walletCommon.ZeroAddress {
		return "", errors.New("destination address is required")
	}

	if parameters.ChainID == nil || *parameters.ChainID == walletCommon.UnknownChainID {
		return "", errors.New("chainID is required")
	}

	if parameters.Symbol == nil || *parameters.Symbol == "" {
		return "", errors.New("symbol is required")
	}

	network := mercuryo.CommonChainIDToNetwork(*parameters.ChainID)
	if network == "" {
		return "", errors.New("unsupported chainID")
	}

	currency := getMercuryoCurrency(*parameters.Symbol)
	if currency == "" {
		return "", errors.New("unsupported symbol")
	}

	// TODO #16005: Move signature generation to proxy server
	signature := getMercuryoSignature(*parameters.DestAddress, widgetSecret)
	url := fmt.Sprintf("%s&network=%s&currency=%s&address=%s&hide_address=false&fix_address=true&signature=%s&widget_id=%s",
		baseURL, network, currency, parameters.DestAddress.Hex(), signature, widgetID)

	if parameters.IsRecurrent {
		url = url + "&widget_flow=recurrent"
	}

	return url, nil
}
